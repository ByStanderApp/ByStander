Version 3: Structured I/O & application-aware logic, tested on multiple scenarios.